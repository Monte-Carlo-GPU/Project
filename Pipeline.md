**Пайплайн работы программы**

1. **Сбор параметров**  
   При запуске программы пользователь последовательно вводит необходимые параметры:  
   - Тип опциона (колл или пут)  
   - Число траекторий (N_PATHS)  
   - Число шагов на траекторию (N_STEPS)  
   - Начальная цена актива (S0)  
   - Страйк (K)  
   - Безрисковая ставка (r)  
   - Волатильность (σ)  
   - Время до экспирации (T)  
   - Дрейф (μ)

2. **Проверка ресурсов и подготовка**  
   Программа определяет доступный объём видеопамяти (cudaMemGetInfo) и рассчитывает максимально возможный размер пакета (batch_size) для обработки траекторий. Выполняется проверка корректности параметров.

3. **Инициализация GPU-ресурсов**  
   - Выделение GPU-памяти для результатов (d_S_batch) и нормальных случайных чисел (d_normals_batch).  
   - Инициализация генератора cuRAND для генерации нормальных случайных чисел.

4. **Пакетная обработка траекторий на GPU**  
   При необходимости траектории разбиваются на пакеты по batch_size. Для каждого пакета:  
   - Генерируются нормальные случайные числа на GPU.  
   - Запускается CUDA-ядро (mc_call_GPU или mc_put_GPU) для оценки выплат.  
   - Результаты копируются на CPU, суммируются для дальнейшего усреднения.

5. **Расчёт цены опциона методом Монте-Карло**  
   После обработки всех пакетов вычисляется средняя выплата и дисконтируется для получения оценки цены опциона.

6. **Аналитический расчёт (Блэк–Шоулз)**  
   На основе введённых параметров (S0, K, r, σ, T) программа рассчитывает аналитическую цену опциона и сравнивает её с методом Монте-Карло.

7. **Логирование результатов**  
   В файл results.txt записываются:  
   - Параметры моделирования и типа опциона  
   - Цена опциона по Монте-Карло  
   - Аналитическая цена по Блэку–Шоулзу и разница с Монте-Карло  
   - Затраченное время вычислений на GPU

8. **Сохранение траекторий в CSV**  
   Из части сгенерированных нормальных чисел восстанавливается несколько траекторий цены актива и сохраняются в файл trajectories.csv в формате:  
   ```
   time,traj_0,traj_1,traj_2
   0.0,100.0,100.0,100.0
   ...
   T,S_T(0),S_T(1),S_T(2)
   ```
   Данные можно визуализировать сторонними инструментами.(мы это делаем с помощью pandas и matlib в python)

9. **Завершение работы**  
   Освобождаются ресурсы GPU, уничтожаются объекты (генератор cuRAND, CUDA-потоки и т.д.). Программа завершается, предоставляя пользователю результаты в файлах results.txt и trajectories.csv.
